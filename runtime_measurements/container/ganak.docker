FROM alpine:3.20.3 AS builder
RUN apk add --no-cache git build-base bash wget

WORKDIR /app
RUN wget https://msoos.org/private/ganak-v2.1-linux64

FROM alpine:3.20.3

RUN apk add --no-cache bash bc coreutils

RUN mkdir /in/
RUN mkdir /out/

WORKDIR /app

COPY --from=builder /app/ganak-v2.1-linux64 /app/ganak
RUN chmod 0777 ganak

COPY runscripts/measure.sh /app/
RUN chmod 0777 measure.sh

COPY runscripts/ganak.sh /app/start.sh
RUN chmod 0777 start.sh

ENTRYPOINT ["/app/measure.sh"]

